# **H5流程梳理**

## **H5 应用中心加载流程梳理**

### 1. 获取当前代码版本

```js
// 获取版本
napi/lang/json?versionOnly=1

// eg:
{
    "code": 200,
    "msg": "获取成功",
    "data": {
        "updatedAt": "23-8-29 14:58:38",
        "version": "23.8.29.1693292318148"
    }
}
```



### 2. 获取服务地址配置信息

```js
// 获取服务地址配置信息
napi/global/server

// eg:
{
    "www": "https://globalrelease.qpaas.com/",
    "sta": "https://globalrelease.qpaas.com/",
    "fileio": "https://globalrelease.qpaas.com/",
    "storeView": "https://globalrelease.qpaas.com/",
    "socketDomain": "wss://globalrelease.qpaas.com/websocket?project=77ff6dec3a71d5409cba181814d4b188",
    "preview": "http://globalrelease-preview-8012:8012"
}
```



### 3. 获取用户信息

```js
// 获取用户信息（新）
sapi/user/entuser/info

// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"userId":"u5000001094987879",
		"roleId":null,
		"departmentId":null,
		"entId":"apiceshiqiye",
		"entName":"API测试企业",
		"departmentName":"qat_rkniu",
		"realName":"前端测试",
		............
	},
	"msg":"成功",
	"guid":"64f157fdc84c80c1"
}
```



### 4. 获取各个API版本


```js
// 获取各个API版本
sapi/user/platformCaching/apiVersion

// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"app":{
			"ceshi1214c":"v20230831174607",
			"syditu7adc":"v20230803190151",
			"wfceshiyingyong":"v20230829104324",
			"ngweikuozhanxinxiy32":"v20230823163453",
			.............			
		},
		"apiVersionCacheRefresh":"v20230831185443-v20230901111545",
		"globalApi":{
			"/api/store/getUMFSize":"v20230824170234",
			"/api2/portal/category":"v20230829160256",
			"/api2/notices/noticepublished":"v20230831110908",
			"/api2/config/watermark":"v20230827131009",
			..............
		}
	},
	"msg":"成功",
	"guid":"64f157fdc1d57bc9"
}
```



### 5. 获取Tabbar配置

```js
// 获取Tabbar配置
portal/navigation?client=miniprogram

// eg:
{
    "status": 200,
    "code": 200,
    "msg": "ok",
    "result": [
        {
            "order": "1",
            "iconName": "tab-yingyong",
            "_id": "apps",
            "title": "应用",
            "type": "apps",
            "is_default": 0,
            "left_head": [
                {
                    "type": "single",
                    "options": [
                        "mysetting"
                    ]
                }
            ],
            "right_head": [],
            "has_header": 1,
            "extraData": {}
        },
        {
            "order": "2",
            "iconName": "tab-people",
            "_id": "mine",
            "title": "我的",
            "type": "mine",
            // ...........
        },
        {
            "order": "3",
            "iconName": "tab-faxian",
            "_id": "portal_miniprogram",
            "title": "小程序门户",
            "type": "portal_miniprogram",
			// ............ 
        },
        {
            "order": "4",
            "iconName": "tab-xuexi",
            "_id": "system",
            "title": "系统",
            "type": "system",
			// ............ 
        }
    ],
    "guid": "dfb3c6613b56f351"
}
```



### 6. 获取应用列表

```js
// 获取应用列表
api2/appcenter/mobileList/new

// eg: 
{
    "status": 200,
    "code": 200,
    "msg": "ok",
    "result": [
        {
            "id": "-1002",
            "name": "常用应用",
            "noticeNum": 0,
            "children": [
                {
                    "name": "",
                    "children": [
                        {
                            "id": "15",
                            "name": "工作协同",
                            "link": "/app/!/workflow/GongZuoXieTong",
                            "parent": "14",
                            "order": "0",
                            "description": "",
                            "icon_name": "qy-channel_programs",
                            "icon_color": "#2398e4",
                            "level": "2",
                            "app_type": "workflow",
                            "app_id": "GongZuoXieTong",
                            "app_show": "1",
                            "image": "",
                            "from_store": "",
                            "personalize": "0",
                            "open_type": "1",
                            "jump_addr": "",
                            "children": [],
                            "showChildren": false,
                            "noticeNum": 0
                        },
// ..............
```



### 7. 获取水印配置

```js
// 获取水印配置
api2/config/watermark?type=webpage

// eg:
{
    "status": 200,
    "code": 200,
    "msg": "ok",
    "result": {
        "words": "11111",
        "font": "Microsoft Yahei",
        "fontSize": "36",
        "color": "#e4e4e4",
        "translucent": "1",
        "format": "1",
        "range": [
            "1",
            "2",
            "4",
            "5"
        ],
        "status": "0",
        "width": "348",
        "height": "238"
    },
    "guid": "76df6c2c0855d9df"
}
```



### 8. 获取未读消息数

```js
// 获取未读消息数
api2/notice/all
```







## View列表页梳理

### 1. 获取当前代码版本（可省）

```js
// 获取版本
napi/lang/json?versionOnly=1

// https://dev.globalrelease.qpaas.com:8082/napi/lang/json?versionOnly=1
```



### 2. 获取服务地址配置信息（可省）

```js
// 获取服务地址配置信息
napi/global/server

// https://dev.globalrelease.qpaas.com:8082/napi/global/server
```



### 3. 获取用户信息（可省）

```js
// 获取用户信息（新）
sapi/user/entuser/info

// https://dev.globalrelease.qpaas.com:8082/sapi/user/entuser/info
```



### 1. 获取各个API版本


```js
// 获取各个API版本
sapi/user/platformCaching/apiVersion

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/sapi/user/platformCaching/apiVersion

// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"app":{
			"ceshi1214c":"v20230831174607",
			"syditu7adc":"v20230803190151",
			"wfceshiyingyong":"v20230829104324",
			"ngweikuozhanxinxiy32":"v20230823163453",
			.............			
		},
		"apiVersionCacheRefresh":"v20230831185443-v20230901111545",
		"globalApi":{
			"/api/store/getUMFSize":"v20230824170234",
			"/api2/portal/category":"v20230829160256",
			"/api2/notices/noticepublished":"v20230831110908",
			"/api2/config/watermark":"v20230827131009",
			..............
		}
	},
	"msg":"成功",
	"guid":"64f157fdc1d57bc9"
}
```



### 2. 获取应用基础信息接口

```js
sapi/designer/appinfo

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/sapi/designer/appinfo/information/anniuceshi53?use=view

// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"name":"DF按钮_7478",
		"description":"",
		"appId":"anniuceshi53",
		"appType":"information",
		"iconName":"qy-default",
		"iconColor":"#62b7ed",
		"dataCenterTables":[
			{
				"tableId":"dfanniu19",
				"type":"master",
				"tableName":"DF按钮19",
				"parentTableId":""
			},
			{
				"tableId":"congbiaoanniu76",
				"type":"slave",
				"tableName":"从表按钮76",
				"parentTableId":""
			},
			{
				"tableId":"dfanniucongbiao2",
				"type":"slave",
				"tableName":"df按钮从表2",
				"parentTableId":""
			}
		],
		"isNewViewAppDesigner":"1",
		"hasPreview":false,
		"defaultTabs":[],
		"nodes":{},
		"version":0,
		"hasOfficial":true,
		"saveBehavior":"close",
		"hasPreviewForMobile":false,
		"hasOfficialForMobile":true,
		"defaultLoginPage":{
			"access":"",
			"page":"view"
		},
		"isNew":"1",
		"viewMigrationButton":false,
		"esSwitch":0,
		"detailMigrationButton":true,
		"hasDetailOfficial":true,
		"hasDetailPreview":false,
		"addType":"master"
	},
	"msg":"成功",
	"guid":"64f15e0e5aa0be87"
}
```





### 3. appInfoV2

```js
api2/app/appInfoV2

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/api2/app/appInfoV2/information/anniuceshi53/app?use=form

// eg:
{
    "status": 200,
    "code": 1000000,
    "msg": "",
    "result": {
        "isCustom": false,
        "jumpType": "",
        "url": "",
        "openService": {},
        "expired": false,
        "expiredNote": "",
        "appBaseInfo": [],
        "newPermission": 0
    },
    "guid": "82b6cb60419ff785"
}
```





### 4. 新设计器获取View组件可见权限

```js
// 包括：可见页签，可见按钮
sapi/designer/appcomponent

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/sapi/designer/appcomponent?appType=information&platform=mobile&appId=anniuceshi53

// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"bindTabs":[],
		"bindButtons":[
			{
				"buttonName":"硬件录入",
				"displayTerminal":{
					"app":1,
					"web":1
				},
				"id":"17577",
				"source":"master",
				"detail":{
					"old_name":"硬件录入",
					"change":"other",
					"index":25,
					"id":"17577",
					"detail":{
						"current_table":{
							"id":"congbiaoanniu76",
							"title":"从表按钮76",
							"isSlaveTable":true
						},
						"field":[
							{
								"current_table":"congbiaoanniu76",
								"symbol":"equal",
								"current_field":"congbiaoanniu1zifuch",
								"source_field":"clwzifuchuan",
								"source_type":"string",
								"source_table":"jibenshujuceshi",
								"current_type":"string"
							}
						],
						"business_type":{
							"equipment":"gun",
							"type":"Scan"
						},
						"source_app":{
							"id":"jibenyewuceshi",
							"title":"基本业务测试",
							"type":"information"
						},
						"source_table":{
							"id":"jibenshujuceshi",
							"title":"基本数据测试",
							"isSlaveTable":false
						}
					},
					"icon_id":"rili"
				},
				"type":"Scan",
				"displayPosition":[
					"list_display",
					"detail_display"
				]
			}
		]
	},
	"msg":"成功",
	"guid":"64f15e0e74b1a19f"
}
```



### 5. 获取水印配置

```js
api2/config/watermark

// https://dev.globalrelease.qpaas.com:8082/api2/config/watermark?type=webpage
```



### 6. 新设计器国际化版本 - viewConfig

```
napi/designer/viewConfig
```



### 7. 获取扩展配置接口

```js
sapi/designer/appExtendConfig

// http://dev.www172168000095.pinwheel.qycloud.com.cn:8081/space-APICeShiQiYe/sapi/designer/appExtendConfig?appId=jibenyewuceshi&appType=information


// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"extendConfig":{
			"onOffSymbol":1,
			"column_color":[],
			"slave_rule_field":[
				{
					"field":"last_modified",
					"form_is_bind":true,
					"sort":"DESC",
					"table":"dfanniucongbiao2"
				},
				{
					"field":"last_modified",
					"form_is_bind":true,
					"sort":"DESC",
					"table":"congbiaoanniu76"
				}
			],
			"top_set":{
				"slave_top_set":"empty_top",
				"main_top_set":""
			},
			"isNewAppDesigner":"1",
			"form_button":[],
			"filter_fields":{
				"filter":[
					{
						"tableId":"dfanniu19",
						"form_is_bind":true,
						"id":"anniuzifuchuan",
						"type":"string",
						"title":"按钮字符串"
					},
					{
						"tableId":"dfanniu19",
						"form_is_bind":true,
						"id":"anniudanxuan",
						"type":"radio",
						"title":"按钮单选"
					},
					{
						"tableId":"dfanniu19",
						"form_is_bind":true,
						"id":"anniu",
						"type":"userinfo",
						"title":"按钮"
					}
				],
				"default_open":{
					"access":[],
					"open_type":""
				},
				"default_label":0
			},
			"isNewViewAppDesigner":"1",
			"onOffSearch":0,
			"intelligent_mining":{
				"access":[],
				"use":0,
				"analysis_field":{
					"field":"",
					"title":"",
					"table":""
				},
				"accessGroup":[]
			},
			"analysis_enabled":false,
			"associate_fields":[],
			"key_slaveColumn":[
				{
					"field":"a11169",
					"title":"111",
					"table":"dfanniucongbiao2"
				},
				{
					"field":"congbiaoanniu1zifuch",
					"title":"从表按钮1字符串",
					"table":"congbiaoanniu76"
				}
			],
			"key_column":{
				"field":"anniuzifuchuan",
				"form_is_bind":true,
				"title":"按钮字符串",
				"table":"dfanniu19"
			},
			"related_switch":{
				"user_custom_label":true,
				"tree_switch":0,
				"lock_tail":true,
				"lock_head":true,
				"detail_tree_switch":false,
				"more_label_hide":false,
				"column_drag":false,
				"show_crumbs":false,
				"label_vertical":false
			}
		},
		"documents":{},
		"businessSwitches":{}
	},
	"msg":"成功",
	"guid":"64f15e0e81e29370"
}
```



### 8. 获取开放平台自定义组件相关配置

```js
sapi/designer/openConfig

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/sapi/designer/openConfig

// eg:
{
	"status":200,
	"code":1000000,
	"result":{
		"codeVersion":"23.9.0",
		"detailCodeVersion":"23.9.0",
		"newOpenDomain":"https://assets.qpaas.com",
		"openNewUpload":false,
		"openDomain":"https://qcloudstorage.qpaas.com",
		"marketDomain":"https://unpkg.qpaas.com"
	},
	"msg":"成功",
	"guid":"64f15e0ee3a4630d"
}
```



### 9. 获取配置接口 - 核心Schema

```js
api2/datacenter/table/schema

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/api2/datacenter/table/schema?tableId=dfanniu19,congbiaoanniu76,dfanniucongbiao2

```



### 10. view获取dataflow列表接口

```js
sapi/designer/dataflow/list

// https://dev.globalrelease.qpaas.com:8082/space-apiceshiqiye/sapi/designer/dataflow/list?platform=mobile

```





































