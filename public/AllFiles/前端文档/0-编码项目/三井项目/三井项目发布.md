# 环境说明：

<font color='red' size=5>192.1.6.48（中国测试环境） 、192.1.6.76（日本测试环境）、10.1.1.76（中国生产环境）</font>



# 一、开发

## 1. 相关信息

### a. 工程地址：

* 主工程：qpaas-frontend-custom-project
  
    * 仓库地址：http://git.qpaas.com/fe/qpaas-frontend-custom-project.git
    * 分支：proj/sanJing-kanChaBaoGao-detail-vue3
    
* 微函数：sanjingLogicFunc

    * 无仓库，本地

        ```js
        // 核心代码
        export async function main(ctx) {
          /*
          console.log('我是逻辑函数：', arguments, ctx);
          console.log('我是参数:', arguments[0]);
          console.log('我是参数:', arguments[0].data.chakanbianhao);
          console.log('当前路径网页：', location.href);
          */
         
          // 拼接新的url
          const urlObj = new URL(location.href);
          const first = urlObj.origin;
          let newUrl = first + '/sanjingSurveyReport/?chakanbianhao=' + arguments[0].data.chakanbianhao;
          
          window.open(newUrl, '_self');
        }
        ```

        

### b. 需求文档：

[（三井定制23.6）增加查勘报告详情页](https://blogqpaas.yuque.com/staff-gbgl2v/uel0qm/two20axi9evnm9yy)



### c. 设计稿

https://codesign.qq.com/s/460906711219225

密码：X46O



### d. 无忧制品发布平台

发布制品平台：https://www.qpaas.com/dashboard



### e. 应用地址 + 账号

http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/space-kehufengxianfuwuxito/app/!/workflow/sheneigongdan?title=%E7%A4%BE%E5%86%85%E5%B7%A5%E5%8D%95

admin_ms/11111111

yangao/11111111 



* 最终地址，手动传参『查看编号』：chakanbianhao
    * http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/sanjingSurveyReport/?chakanbianhao=fxck_20231206002



### f. 发布相关地址

* 打开 http://localhost:3001

* 打开无忧发布平台：https://www.qpaas.com/devops/product/list

* 平台地址
    * <font color='red' size=5>内部地址，关闭梯子</font>
    * http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/
    * admin_ms / 11111111
* 应用 - **查勘报告**：http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/space-kehufengxianfuwuxito/app/!/information/fuwubaogao?title=%E6%9F%A5%E5%8B%98%E6%8A%A5%E5%91%8A

* 应用 - **查勘工单**：http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/space-kehufengxianfuwuxito/app/!/workflow/chakangongdan?title=%E6%9F%A5%E5%8B%98%E5%B7%A5%E5%8D%95&labelId=6998967337760067586



## 2. 运行

* 开发环境：http://wuyouxiangmu2212fuwu-gqhdlz.k8s-assembly-machine.qpaas.com/      
    * admin_ms/11111111

* 孙旺本地环境（后期忽略）：http://10.0.20.122:9706



### a. 本地运行步骤：

* 更换 `vite.config.js` 中 cookies，从开发环境中拷贝过来
* 运行：`pnpm run dev`
* 运行成功：  ➜  Local:   http://localhost:5173/
    * 运行成功，程序直接崩溃，不用管

* 打开页面路径：http://localhost:5173/sanjingSurveyReport/?chakanbianhao=fxck_20231206002
    * `/sanjingSurveyReport`：是应用路径
    * [新]：`/risk/sanjingSurveyReport`：第九节
    * `?chakanbianhao=fxck_20231206002`：是参数，可以从开发环境中的『查勘报告』中找一个





# 二、三井发布流程 - 公司内部环境

## 1. 发布两个包

```sh
$ qpaas ui
server start at http://localhost:3001
[HPM] Proxy created: /  -> https://cidemo.qpaas.com
[HPM] Proxy created: /  -> https://cidemo.qpaas.com
🚀 Starting Mod-service...
🌠 Ready on http://localhost:3001
socket 8mF4DNR1lUaPIS80AAAB connect success
```

打开 http://localhost:3001

选择『安全无忧』环境

![](/AllFiles/前端文档/0-编码项目/三井项目/images/001.png)



**打包上传**

![](/AllFiles/前端文档/0-编码项目/三井项目/images/002.png)



打开无忧发布平台：https://www.qpaas.com/devops/product/list

![](/AllFiles/前端文档/0-编码项目/三井项目/images/003.png)



标记制品 --------> 发布制品

测试环境选择：无忧 项目开发二号集群

![](/AllFiles/前端文档/0-编码项目/三井项目/images/005.png)



## 2. 测试

http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/

admin_ms / 11111111



应用 - **查勘报告**：http://hxjtaqscglxt-wuyou229fuwushang-jyahhj.k8s-assembly-machine.qpaas.com/space-kehufengxianfuwuxito/app/!/information/fuwubaogao?title=%E6%9F%A5%E5%8B%98%E6%8A%A5%E5%91%8A





# 三、三井发布到项目环境



## 192.1.6.48（中国测试环境）

> 需要找无忧运维『无忧 - 孙飞虎』远程控制进行操作发布。

* 客户测试环境
* 需要 VPN - 找孙飞虎
* 堡垒机：http://192.1.6.48:58080
* 平台地址：http://192.1.6.48:8000
    * admin_ms / aykj@83752661

* 国内测试环境\查勘报告菜单测试环境：http://risk.ecrm-test.ms-ins.com.cn/ （IP:192.1.6.48）



## 10.1.1.76（中国生产环境）

* 【需要VPN】 http://10.1.1.76:8000/
* 【需要VPN】 http://10.1.1.76:28000/
* 【需要VPN】http://10.1.1.76:58080/

* 【不需要VPN】域名地址：https://risk-ecrm.ms-ins.com.cn/
    * admin_ms / aykj@83752661







### <font color='red'>『闭环改善』按钮在生产环境下跳转需要定制：</font>

1. `<script src="/napi/unpkg/global.js"></script>`

![](/AllFiles/前端文档/0-编码项目/三井项目/images/016.png)



2. 闭环改善按钮打开新页面 【仅在生产环境修改】

```js
// 跳转到“闭环改善”应用列表页。
const lastButtomBtnClick = () => {
	// ?soloNakedLayout=1 隐藏顶部与左侧菜单栏
    
    // Before
    // window.open(baseURL + 'app/!/workflow/bihuanzhenggai?soloNakedLayout=1', '_blank');
  
    // New
	window.open(window.deployBaseRoute + 'space-kehufengxianfuwuping/app/!/workflow/bihuanzhenggai?soloNakedLayout=1', '_blank');
}   
```

* `window.deployBaseRoute`  ： /

![](/AllFiles/前端文档/0-编码项目/三井项目/images/021.png)



## 第一步：从内部环境直接导出包





## 第二步：远程操作三井运维平台

三井运维平台 - 五指山

http://192.1.6.48:58080/static/dashboard#/static/dashboard

```
环境信息：
开发环境（公司内网访问）：
http://shukechanpinkaifa-wrrcyk.k8s-assembly-machine.qpaas.com/space-kehufengxianfuwuxito/user/workbench      admin_ms/11111111

测试环境（VPN访问）：
http://risk.ecrm-test.ms-ins.com.cn/space-kehufengxianfuwuxito/app/!/information/pinggubiaozhun            admin_ms/aykj@83752661

生产环境（公司内网访问）：
https://risk-ecrm.ms-ins.com.cn/home/login           admin_ms/aykj@83752661
```



### 上传包

![](/AllFiles/前端文档/0-编码项目/三井项目/images/006.png)

![](/AllFiles/前端文档/0-编码项目/三井项目/images/007.png)





## 第三步：应用 和 配置

测试环境（VPN访问）：

http://risk.ecrm-test.ms-ins.com.cn/space-kehufengxianfuwuxito/app/!/information/pinggubiaozhun            

http://192.1.6.48:8000/space-kehufengxianfuwuxito/appcenter

admin_ms/aykj@83752661



查看工单 生成 查勘报告，前往『查勘报告』配置页面，配置首列点击打开『微函数』。

![](/AllFiles/前端文档/0-编码项目/三井项目/images/004.png)



## 第四步：『查勘工单』应用 - 配置『预览』按钮

![](/AllFiles/前端文档/0-编码项目/三井项目/images/017.png)

![](/AllFiles/前端文档/0-编码项目/三井项目/images/018.png)

![](/AllFiles/前端文档/0-编码项目/三井项目/images/019.png)



配置预览按钮：

![](/AllFiles/前端文档/0-编码项目/三井项目/images/020.png)



# 四、优化工单

查勘网页版UAT测试问题清单--查勘报告详情页1012

https://docs.qq.com/sheet/DSUZqZWxWSU9sdFR0?tab=000001



# 五、新增POC日文环境

## 1. 环境 - 192.1.6.76

日本测试环境（POC）
http://192.1.6.76:28000
管理员账号：admin_ms / aykj@83752661
堡垒机：http://192.1.6.76:58080



* 操作路径：客户风险服务平台--风险查勘中心--风险勘察计划--查勘报告

* **远程操作任万春的电脑**
    * 向日葵：1842264333 / aykj1234



## 2. 兼容规则

兼容日文POC环境

```js
  /** 定制：日本POC环境
   * report接口的参数reportType改成type，再加一个language参数
   * 在生产环境中：中文参数是type=1， language=chinese，日文参数是type=2，language=japanese
   * 在poc环境中，type=1，language=japanese
   */
```



## 3. 发布







# 六、应用中『导出』按钮文件名称定制

开发微函数

```sh
$ qpaas ui
```

打开网页：http://localhost:3001/

制品发布平台：https://www.qpaas.com/



最终方案：该导出按钮是自定义的链接，移交给孙旺处理了。





# 七、POC新加坡环境发布

他们那么批量导出，暂不需要处理！！



## 1. 问题记录

问题：

![](/AllFiles/前端文档/0-编码项目/三井项目/images/008.png)

原因、解决：

![](/AllFiles/前端文档/0-编码项目/三井项目/images/009.png)

![](/AllFiles/前端文档/0-编码项目/三井项目/images/010.png)

![](/AllFiles/前端文档/0-编码项目/三井项目/images/011.png)



# 八、三井项目二期 - 2024.12.06

* 二期文档：自行前往
    * 首页新页面打开，屏蔽上面左边菜单；
    2. 改善建议 - 改善确认屏蔽左边菜单；
    3. 勘察报告中除风险查勘类型外其他类型都不需要进入新页面（其他类型数据不能）。







# 九、新增 `/risk` 路径 - 2024.12.11

* 要求：现在是只要改 192.1.6.76 这个环境
* 2025.02.14 发布到 `10.1.1.76` ，也加上 /risk
* 类似于：http://localhost:5173/risk/sanjingSurveyReport/?chakanbianhao=fxck_20231206002

![](/AllFiles/前端文档/0-编码项目/三井项目/images/012.png)





# 十、二期发布到 `10.1.1.76` 问题 - 2025.02.14

## 1. 导出问题

![](/AllFiles/前端文档/0-编码项目/三井项目/images/013.png)



### 原因：报告模板配置的问题



## 2. 代码问题

已修复到 《2期 - 工单》





























