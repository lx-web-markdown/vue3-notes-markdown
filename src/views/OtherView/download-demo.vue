<template>
  <div class="download-demo-container">
    <h1 class="title">Êñá‰ª∂‰∏ãËΩΩÁ§∫‰æã</h1>

    <div class="download-cards">
      <div class="download-card">
        <h3>ÊñπÂºè‰∏ÄÔºöHTMLÂéüÁîüÈìæÊé•</h3>
        <p>‰ΩøÁî®HTMLÁöÑaÊ†áÁ≠ædownloadÂ±ûÊÄßÁõ¥Êé•‰∏ãËΩΩÊñá‰ª∂</p>
        <a
          class="download-link"
          href="/public/AllFiles/Â∑•‰ΩúÈöèÁ¨î/2023Âπ¥Â∫¶Â•óÈ§êÊñπÊ°à.xlsx"
          download="download.xlsx"
        >
          <span class="icon">üì•</span>‰∏ãËΩΩExcelÊñá‰ª∂
        </a>
      </div>

      <div class="download-card">
        <h3>ÊñπÂºè‰∫åÔºöJSÂàõÂª∫‰∏¥Êó∂ÈìæÊé•</h3>
        <p>ÈÄöËøáJavaScriptÂä®ÊÄÅÂàõÂª∫ÈìæÊé•Âπ∂Ëß¶ÂèëÁÇπÂáª‰∫ã‰ª∂‰∏ãËΩΩ</p>
        <button class="download-btn" @click="downloadFile" :disabled="isDownloading">
          <span class="icon">üì•</span>
          <span v-if="isDownloading">‰∏ãËΩΩ‰∏≠...</span>
          <span v-else>‰∏ãËΩΩÊñá‰ª∂</span>
        </button>
      </div>

      <div class="download-card">
        <h3>ÊñπÂºè‰∏âÔºöÊñ∞Á™óÂè£ÊâìÂºÄ</h3>
        <p>Âú®Êñ∞Ê†áÁ≠æÈ°µ‰∏≠ÊâìÂºÄÊñá‰ª∂ÔºåÁî±ÊµèËßàÂô®ÂÜ≥ÂÆöÊòØÊòæÁ§∫ËøòÊòØ‰∏ãËΩΩ</p>
        <button class="download-btn" @click="openFileInNewTab">
          <span class="icon">üîó</span>Âú®Êñ∞Á™óÂè£ÊâìÂºÄ
        </button>
      </div>

      <div class="download-card">
        <h3>ÊñπÂºèÂõõÔºö‰∏ãËΩΩBlobÊñá‰ª∂</h3>
        <p>ÈÄöËøáBlobÂØπË±°‰∏ãËΩΩÊñá‰ª∂</p>
        <button class="download-btn" @click="downloadBlob">
          <span class="icon">üì•</span>‰∏ãËΩΩÊñá‰ª∂
        </button>
      </div>

      <div class="download-card">
        <h3>ÊñπÂºè‰∫îÔºö‰∏ãËΩΩURLÊñá‰ª∂</h3>
        <p>ÈÄöËøáURL‰∏ãËΩΩÊñá‰ª∂</p>
        <button class="download-btn" @click="downloadFromUrl">
          <span class="icon">üì•</span>‰∏ãËΩΩÊñá‰ª∂
        </button>
      </div>

      <div class="download-card">
        <h3>ÊñπÂºèÂÖ≠Ôºö‰∏ãËΩΩBase64Êñá‰ª∂</h3>
        <p>ÈÄöËøáBase64‰∏ãËΩΩÊñá‰ª∂</p>
        <button class="download-btn" @click="downloadBase64">
          <span class="icon">üì•</span>‰∏ãËΩΩÊñá‰ª∂
        </button>
      </div>
    </div>
    <div v-if="downloadMessage" :class="['download-message', downloadStatus]">
      {{ downloadMessage }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const isDownloading = ref(false);
const downloadMessage = ref('');
const downloadStatus = ref('');

// ÊñπÂºè‰∫åÔºöJSÂàõÂª∫‰∏¥Êó∂ÈìæÊé•‰∏ãËΩΩ
const downloadFile = () => {
  try {
    isDownloading.value = true;
    downloadMessage.value = 'Êñá‰ª∂‰∏ãËΩΩ‰∏≠...';
    downloadStatus.value = 'info';

    const url = '/public/AllFiles/Â∑•‰ΩúÈöèÁ¨î/2023Âπ¥Â∫¶Â•óÈ§êÊñπÊ°à.xlsx';
    const a = document.createElement('a');
    a.href = url;
    a.download = '2023Âπ¥Â∫¶Â•óÈ§êÊñπÊ°à.xlsx';
    a.click();

    // Ê®°Êãü‰∏ãËΩΩÂÆåÊàê
    setTimeout(() => {
      downloadMessage.value = 'Êñá‰ª∂‰∏ãËΩΩÊàêÂäüÔºÅ';
      downloadStatus.value = 'success';
      isDownloading.value = false;

      // 3ÁßíÂêéÊ∏ÖÈô§Ê∂àÊÅØ
      setTimeout(() => {
        downloadMessage.value = '';
      }, 3000);
    }, 1500);
  } catch (error) {
    downloadMessage.value = '‰∏ãËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
    downloadStatus.value = 'error';
    isDownloading.value = false;
  }
};

// ÊñπÂºè‰∏âÔºöÊñ∞Á™óÂè£ÊâìÂºÄÊñá‰ª∂
const openFileInNewTab = () => {
  const url = '/public/AllFiles/Â∑•‰ΩúÈöèÁ¨î/2023Âπ¥Â∫¶Â•óÈ§êÊñπÊ°à.xlsx';
  window.open(url, '_blank');

  downloadMessage.value = 'Êñá‰ª∂Â∑≤Âú®Êñ∞Á™óÂè£ÊâìÂºÄ';
  downloadStatus.value = 'info';

  // 3ÁßíÂêéÊ∏ÖÈô§Ê∂àÊÅØ
  setTimeout(() => {
    downloadMessage.value = '';
  }, 3000);
};

// ‰∏ãËΩΩBlobÊñá‰ª∂ÁöÑÊ†∏ÂøÉÂáΩÊï∞
function downloadBlob_Core(blob: Blob, filename: string) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename || 'downloaded-file';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => {
    document.body.removeChild(a);
    // ÈáäÊîæÂàõÂª∫ÁöÑURLÂØπË±°,ÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÊºè
    URL.revokeObjectURL(url);
  }, 100);
}

// ‰∏ãËΩΩBlobÊñá‰ª∂
const downloadBlob = () => {
  // ‰ΩøÁî®Á§∫‰æãÔºö‰∏ãËΩΩÊñáÊú¨Êñá‰ª∂
  const text = 'Hello, world!';
  const blob = new Blob([text], { type: 'text/plain' });
  downloadBlob_Core(blob, 'example.txt');
};

// ‰∏ãËΩΩURLÊñá‰ª∂ÁöÑÊ†∏ÂøÉÂáΩÊï∞
async function downloadFromUrl_Core(url: string, filename: string) {
  try {
    const response = await fetch(url);
    const blob = await response.blob();
    downloadBlob_Core(blob, filename);
  } catch (error) {
    console.error('Download failed:', error);
  }
}

// ‰∏ãËΩΩURLÊñá‰ª∂
const downloadFromUrl = async () => {
  // ‰ΩøÁî®Á§∫‰æã
  downloadFromUrl_Core('/public/AllFiles/Â∑•‰ΩúÈöèÁ¨î/2023Âπ¥Â∫¶Â•óÈ§êÊñπÊ°à.xlsx', 'my-xxx.xlsx');
};

// ‰∏ãËΩΩBase64Êñá‰ª∂ÁöÑÊ†∏ÂøÉÂáΩÊï∞
function downloadBase64_Core(base64Data: string, filename: string, mimeType: string) {
  const byteCharacters = atob(base64Data.split(',')[1]);
  const byteNumbers = new Array(byteCharacters.length);
  
  for (let i = 0; i < byteCharacters.length; i++) {
    byteNumbers[i] = byteCharacters.charCodeAt(i);
  }

  const byteArray = new Uint8Array(byteNumbers);
  const blob = new Blob([byteArray], { type: mimeType });
  downloadBlob_Core(blob, filename);
}

// ‰∏ãËΩΩBase64Êñá‰ª∂
const downloadBase64 = () => {
  // ‰ΩøÁî®Á§∫‰æã
  const base64Data = 'data:image/png;base64,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';
  downloadBase64_Core(base64Data, 'image.png', 'image/png');
};

</script>

<style scoped lang="scss">
.download-demo-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
  font-family: 'PingFang SC', Arial, sans-serif;
}

.title {
  color: #2c3e50;
  text-align: center;
  margin-bottom: 30px;
  font-weight: 600;
}

.download-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.download-card {
  background: #ffffff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s, box-shadow 0.3s;
  display: flex;
  flex-direction: column;

  &:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  }

  h3 {
    color: #2c3e50;
    margin-top: 0;
    margin-bottom: 10px;
  }

  p {
    color: #606266;
    margin-bottom: 20px;
    flex-grow: 1;
  }
}

.download-link,
.download-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 20px;
  background: #409eff;
  color: white;
  border-radius: 4px;
  text-decoration: none;
  font-weight: 500;
  border: none;
  cursor: pointer;
  transition: background 0.3s;

  &:hover {
    background: #66b1ff;
  }

  &:active {
    background: #3a8ee6;
  }

  &:disabled {
    background: #a0cfff;
    cursor: not-allowed;
  }
}

.icon {
  margin-right: 8px;
  font-size: 18px;
}

.download-message {
  padding: 12px 20px;
  border-radius: 4px;
  margin-top: 20px;
  text-align: center;

  &.info {
    background: #e1f3ff;
    color: #1890ff;
  }

  &.success {
    background: #f0f9eb;
    color: #67c23a;
  }

  &.error {
    background: #fef0f0;
    color: #f56c6c;
  }
}
</style>
